# 项目配置

在`vue.config.js`文件中配置。

1. **运行项目自动打开**

   ```diff
   const { defineConfig } = require('@vue/cli-service')
   module.exports = defineConfig({
     transpileDependencies: true,
   +  devServer: {
   +    open: true,  // 自动打开0.0.0.0:8080
   +    host: 'localhost'  // 设置打开网址为localhost:8080
   +  }
   })
   ```

2. **安装Element-UI**

   安装：`npm i element-ui -S`

   `main.js`中全局引入：

   ```js
   import ElementUI from 'element-ui'
   import 'element-ui/lib/theme-chalk/index.css'
   
   Vue.use(ElementUI)
   ```

3. **样式重置**

   安装normalize.css：`npm install normalize.css`

   `main.js`中引入：`import 'normalize.css'`

4. **引入图标库**

   在index.html中引入阿里的图标库：

   ```html
   <link rel="stylesheet" href="//at.alicdn.com/t/c/font_3766972_io8ty08n0w.css">
   ```

   使用：

   ```html
   <i class="iconfont icon-xxx"></i>
   ```

5. **axios封装和跨域配置**

   ```js
   // @/utils/request.js
   
   import axios from 'axios'
   import { getToken } from './setToken';
   import { Message } from 'element-ui';
   
   const request = axios.create({
     baseURL: '/api',
     timeout: 3000
   })
   
   // 添加请求拦截器
   request.interceptors.request.use((config) => {
     // 在请求之前获取并设置token
     config.headers['token'] = getToken('token');
     return config;
   }, (error) => {
     return Promise.reject(error);
   })
   
   // 添加响应拦截器
   request.interceptors.response.use((res) => { 
     let { status, message } = res.data;
     if (status !== 200) {
       Message({ message: message || 'error', type: 'warning' });
     }
     return res;
   }, (error) => {
     return Promise.reject(error);
   })
   
   export default request
   ```

   ```js
   // main.js
   
   import request from '@/utils/request'
   Vue.prototype.request = request  // 挂载到原型，全局可用
   ```

   ```diff
   // vue.config.js
   
   const { defineConfig } = require('@vue/cli-service')
   module.exports = defineConfig({
     transpileDependencies: true,
     devServer: {
       open: true,  // 自动打开
       host: 'localhost',  // 设置打开网址localhost:8080
   +    proxy: {  // 跨域配置
   +      '/api': {
   +        target: 'http://1.116.64.64:5004/api2/',
   +        changeOrigin: true,
   +        pathRewrite: {
   +          '^/api': ''
   +        }
   +      }
   +    }
     }
   })
   ```

6. **token方法封装**

   ```js
   // @/utils/setToken.js
   
   export function setToken(tokenKey, token) {
       return localStorage.setItem(tokenKey, token);
   }
   
   export function getToken(tokenKey) {
       return localStorage.getItem(tokenKey);
   }
   
   export function removeToken(tokenKey) {
       return localStorage.removeItem(tokenKey);
   }
   ```

7. **配置路由**

   ```js
   // @/router/index.js
   
   import Vue from 'vue'
   import VueRouter from 'vue-router'
   
   Vue.use(VueRouter)
   
   const routes = [
     { path: '/', redirect: '/login', component: () => import('@/components/Login.vue') },
     { path: '/login', name: 'Login', component: () => import('@/components/Login.vue') },
     { path: '/home', name: 'Home', component: () => import('@/components/Home.vue') },
     { path: '*', name: 'NotFound', component: () => import('@/components/NotFound.vue') }
   ]
   
   const router = new VueRouter({
       routes
   })
   export default router
   ```

   `App.vue`中设置路由出口`<router-view></router-view>`

# 登录页

1. **创建Login组件**：`@/components/Login.vue`

2. **使用element-ui搭建基础布局**

   ```vue
   <template>
     <div class="login">
       <el-card class="box-card">
         <div slot="header" class="clearfix">
           <span>通用后台管理系统</span>
         </div>
         <!-- 表单 -->
         <el-form ref="form" :model="form" label-width="80px" :rules="rules">
           <el-form-item label="用户名" prop="username">
             <el-input v-model="form.username"></el-input>
           </el-form-item>
           <el-form-item label="密码" prop="password">
             <el-input v-model="form.password" type="password"></el-input>
           </el-form-item>
           <el-form-item>
             <el-button type="primary" @click="login('form')">登录</el-button>
           </el-form-item>
         </el-form>
       </el-card>
     </div>
   </template>
   
   <script>
   export default {
       data () {
           return {
               form: {
                   username: '',
                   password: ''
               }
           }
       }
   }
   </script>
   
   <style lang="less">
   .login {
     width: 100%;
     height: 100%;
     position: absolute;
     background: url('../assets/bg.jpg') center no-repeat;
     .el-card {
       background: #65768557;
     }
     .box-card {
       width: 450px;
       margin: 200px auto;
       color: #fff;
       .el-form .el-form-item__label {
           color: #fff;
       }
       .el-card__header {
         font-size: 34px;
       }
       .el-button {
         width: 100%;
       }
     }
   }
   </style>
   ```

3. **表单校验**

   新建JS文件：`@/utils/vaildate.js`

   ```js
   // 用户名正则匹配
   export function nameRule(rule, value, callback) {
     let regName = /(^[a-zA-Z0-9]{4,10}$)/;
     if (value === '') callback(new Error('请输入用户名'));
     else if (!regName.test(value)) callback(new Error('请输入4-10位用户名'));
     else callback();
   }
   
   // 密码正则匹配
   export function passwordRule(rule, value, callback) {
     let regPassword = /^\S*(?=\S{6,12})(?=\S*\d)(?=\S*[A-Z])(?=\S*[a-z])(?=\S*[!@#$%^&*? ])\S*$/;
     if (value === '') callback(new Error('请输入密码'));
     else if (!regPassword.test(value)) callback(new Error('请输入6-12密码，必须包含小写、大写字母、数字和特殊字符'));
     else callback();
   }
   ```

4. **在`Login.vue`组件中使用表单校验**

   > **el-form的方法：validate**
   >
   > 对整个表单进行校验的方法，参数为一个回调函数。该回调函数会在校验结束后被调用，并传入两个参数：是否校验成功和未通过校验的字段。若不传入回调函数，则会返回一个 promise

   > rules: {
   >
   > ​    field: [validator: 校验规则函数, trigger: 校验触发方式]
   >
   > }
   >
   > trigger: 'change' 数据改变时触发
   >
   > trigger: 'blur' 失去焦点触发

   ```vue
   <script>
   import { nameRule, passwordRule } from '@/utils/validate.js'
   export default {
       data () {
           return {
               ...,
               // 表单校验规则
               rules: {
                   username: [{ validator: nameRule, trigger: 'blur' }],
                   password: [{ validator: passwordRule, trigger: 'blur' }]
               }
           }
       }
   }
   </script>
   ```

5. **封装登录方法并为登录按钮绑定点击事件**

   ```js
   // @/api/api.js
   
   import request from '@/utils/request'
    export function login(data) {
        return request({
            method: 'post',
            url: '/login',
            data
        })
    }
   ```

   ```vue
   <script>
   import { login } from '@/api/api'
   import { setToken } from '@/utils/setToken'
   export default {
       ...,
       methods: {
           login(form) {
   			this.$refs[form].validate((valid) => {
                   if (valid) {
                       login(this.form).then(res => {
                           if (res.data.status === 200) {
                               setToken('username', res.data.username);
                               setToken('token', res.data.token);
                               this.$message({ message: res.data.message, type: 'success' });
                               this.$router.push('/home');
                           } else {
                               this.$message({ message: res.data.message, type: 'error' });
                           }
                       })
                   }
               })
           }
       }
   }
   </script>
   ```

# 404页面

```vue
// NotFound.vue

<template>
  <div class="notfound">
    <div class="wrapper">
        <div class="big">页面不见了！</div>
        <div>首页瞧瞧，点击<router-link to="/">这里</router-link>进入首页.</div>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {};
  },
};
</script>

<style scoped>
.notfound {
  height: 100%;
  background-image: url('../assets/astronauta.jpg'), url('../assets/stars404.png');
  background-position: right top, center center;
  background-repeat: no-repeat, repeat;
  background-size: cover, auto;
}
.notfound .wrapper {
  position: absolute;
  top: 60%;
  right: 2%;
  color: #fff;
  width: 635px;
  font-size: 19px;
  line-height: 29px;
  -webkit-font-smoothing: antialiased;
  padding: 20px;
  font-family: 'Source Sans Pro', sans-serif;
}
.notfound .wrapper .big {
  font-size: 74px;
  font-weight: 700;
  line-height: 68px;
  margin-bottom: 48px;
}
.notfound .wrapper a {
  color: #ffcc00;
  text-decoration: none;
  font-weight: 700;
  cursor: pointer;
}
@media only screen and (max-width: 666px) {
  .notfound .wrapper {
    left: auto;
    right: 0;
    width: 100%;
    max-width: 450px;
    top: 35%;
  }
  .notfound .wrapper .big {
    font-size: 42px;
    line-height: 50px;
    margin-bottom: 15px;
  }
}
</style>
```

注：需要设置`App.vue`样式

# 首页

## 首页Home组件布局

```vue
// @/components/Home.vue
<template>
  <div class="home">
      <Header/>
      <el-container class="content">
        <Menu/>
        <el-container>
          <el-main>
            <div class="cont">
              <!-- 路由出口 -->
              <router-view></router-view>
            </div>
          </el-main>
          <el-footer><Footer/></el-footer>
        </el-container>
      </el-container>
  </div>
</template>

<script>
import Header from './common/Header.vue'
import Menu from './common/Menu.vue'
import Footer from './common/Footer.vue'
export default {
    name: 'Home',
    components: { Header, Menu, Footer }
}
</script>

<style lang="less" scoped>
.home {
  width: 100%;
  height: 100%;
  .content {
    position: absolute;
    width: 100%;
    top: 60px;
    bottom: 0;
    .cont {
      margin: 20px;
    }
  }
}
</style>
```

## 头部Header组件布局

```vue
<template>
  <div class="header">
    <el-header>
      <div class="title">通用管理系统</div>
      <div>{{name}}</div>
    </el-header>
  </div>
</template>

<script>
import { getToken } from '@/utils/setToken'
export default {
  name: 'Header',
  data() {
    return {
      name: ''
    }
  },
  created() {
    this.name = getToken('username');
  }
}
</script>

<style lang="less" scoped>
.header {
  .el-header {
    background: #2578b5;
    color: #fff;
    line-height: 60px;
    display: flex;
    justify-content: space-between;
    .title {
      width: 200px;
      font-size: 24px;
    }
  }
}
</style>
```

- 通过封装的`getToken`方法获取用户名。

## 底部Footer组件布局

```vue
<template>
  <div class="footer">
    <el-card>
      FrontEnd 2022 YangLu
    </el-card>
  </div>
</template>

<script>
export default {
  name: 'Footer'
}
</script>
```

## 菜单Menu组件布局

1. **配置路由和相关子组件**

   ```js
   const routes = [
     { path: '/', redirect: '/login', hidden: true, component: () => import('@/components/Login.vue') },
     { path: '/login', name: 'Login', hidden: true, component: () => import('@/components/Login.vue') },
     { path: '*', name: 'NotFound', hidden: true, component: () => import('@/components/NotFound.vue') },
     {
       path: '/home',
       name: '学生管理',
       iconClass: 'iconfont icon-study-fill',
       redirect: '/home/student',
       component: () => import('@/components/Home.vue'),
       children: [
         { path: '/home/student', name: '学生列表', component: () => import('@/components/students/StudentList.vue') },
         { path: '/home/info', name: '信息列表', component: () => import('@/components/students/InfoList.vue') },
         { path: '/home/infos', name: '信息管理', component: () => import('@/components/students/InfoLists.vue') },
         { path: '/home/work', name: '作业列表', component: () => import('@/components/students/WorkList.vue') },
         { path: '/home/works', name: '作业管理', component: () => import('@/components/students/WorkMent.vue') }
       ]
     },
     {
       path: '/home',
       name: '数据分析',
       iconClass: 'iconfont icon-maps',
       component: () => import('@/components/Home.vue'),
       children: [
         { path: '/home/dataview', name: '数据概览', component: () => import('@/components/dataAnalysis/DataView.vue') },
         { path: '/home/mapview', name: '地图概览', component: () => import('@/components/dataAnalysis/MapView.vue') },
         { path: '/home/travel', name: '旅游地图', component: () => import('@/components/dataAnalysis/TravalMap.vue') },
         { path: '/home/score', name: '分数地图', component: () => import('@/components/dataAnalysis/ScoreMap.vue') }
       ]
     },
     {
       path: '/users',
       name: '用户中心',
       iconClass: 'iconfont icon-user',
       component: () => import('@/components/Home.vue'),
       children: [
         { path: '/users/user', name: '权限管理', iconClass: 'iconfont icon-user', component: () => import('@/components/users/User.vue') }
       ]
     }
   ]
   ```

2. **实现左侧菜单**

   ```vue
   // Menu.vue
   
   <template>
     <div class="menu">
       <el-aside width="200px">
         <el-menu
           router
           default-active="2"
           class="el-menu-vertical-demo"
           background-color="#2578b5"
           text-color="#fff"
           active-text-color="#ffd04b"
         >
           <template v-for="(item, index) in menus">
             <el-submenu :index="index + ''" :key="index" v-if="!item.hidden">
               <template slot="title">
                 <i :class="item.iconClass"></i>
                 <span>{{ item.name }}</span>
               </template>
               <el-menu-item-group
                 v-for="(child, index) in item.children"
                 :key="index"
               >
                 <el-menu-item :index="child.path">
                   <i :class="child.iconClass"></i>
                   {{ child.name }}
                 </el-menu-item>
               </el-menu-item-group>
             </el-submenu>
           </template>
         </el-menu>
       </el-aside>
     </div>
   </template>
   
   <script>
   export default {
     name: 'Menu',
     data() {
       return {
         menus: [],
       }
     },
     created() {
       this.menus = [...this.$router.options.routes]
     },
   }
   </script>
   
   <style lang="less" scoped>
   .menu {
     .el-aside {
       height: 100%;
       .el-menu {
         height: 100%;
         .iconfont {
           margin-right: 10px;
         }
       }
       .el-submenu,
       .el-menu-item {
         min-width: 0;
       }
     }
   }
   </style>
   ```

- 在配置路由的时候，设置展示的图标`iconClass`和是否显示`hidden: true`（login这些路由不显示到左侧菜单中）
- 通过`this.$router.options.routes`得到配置的路由，用来遍历渲染左侧菜单项

## 面包屑Breadcrumb组件

1. **面包屑组件基础布局**

   ```vue
   <template>
     <div>
       <el-card>
         <el-breadcrumb separator-class="el-icon-arrow-right">
           <el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>
           <el-breadcrumb-item v-for="(item, index) in $route.matched" :key="index">{{item.name}}</el-breadcrumb-item>
         </el-breadcrumb>
       </el-card>
     </div>
   </template>
   
   <script>
   export default {
     name: 'Breadcrumb'
   }
   </script>
   ```

2. **在Home组件中引入面包屑组件**

   ```diff
   <template>
     <div class="home">
         <Header/>
         <el-container class="content">
           <Menu/>
           <el-container>
             <el-main>
   +            <Breadcrumb/>
               <div class="cont">
                 <router-view></router-view>
               </div>
             </el-main>
             <el-footer><Footer/></el-footer>
           </el-container>
         </el-container>
     </div>
   </template>
   
   <script>
   import Header from './common/Header.vue'
   import Menu from './common/Menu.vue'
   import Footer from './common/Footer.vue'
   +import Breadcrumb from './common/Breadcrumb.vue'
   export default {
     name: 'Home',
   +  components: { Header, Menu, Footer, Breadcrumb },
   }
   </script>
   ```

- 使用`$route.matched`获取当前所在菜单项，从而渲染到面包屑组件中

# 学生管理

## 学生列表StudentList组件

1. **封装学生列表查询接口**

   ```js
   // @/api/api.js
   
   export function students(params) {
     return request({
       method: 'get',
       url: '/students',
       params
     })
   }
   ```

2. **StudentList组件基础布局**

   ```vue
   <template>
     <div class="studentList">
       <el-table
       :data="tableData"
       border
       style="width: 100%">
       <el-table-column prop="name" label="姓名" align="center"> </el-table-column>
       <el-table-column prop="sex" label="性别" align="center"> </el-table-column>
       <el-table-column prop="age" label="年龄" align="center"> </el-table-column>
       <el-table-column prop="number" label="学号" align="center"> </el-table-column>
       <el-table-column prop="class" label="班级" align="center"> </el-table-column>
       <el-table-column prop="state" label="状态" align="center"> </el-table-column>
       <el-table-column prop="address" label="地址" align="center"> </el-table-column>
       <el-table-column prop="phone" label="联系方式" align="center"> </el-table-column>
       <el-table-column label="操作" align="center">
         <template>
           <div>
             <el-button type="danger" size="mini" icon="el-icon-delete"></el-button>
           </div>
         </template>
       </el-table-column>
     </el-table>
     </div>
   </template>
   ```

3. **在StudentList组件中通过学生列表查询接口获取数据**

   先在methods定义方法，然后在created生命周期函数中调用。

   ```vue
   <script>
   import { students } from '@/api/api.js' 
   export default {
      data() {
         return {
           tableData: []
         }
       },
       methods: {
         getData (params) {
           students(params).then(res => {
             if (res.data.status === 200) {
               this.tableData = res.data.data;
             }
           })
         }
       },
       created() {
         this.getData();
       }
   }
   </script>
   ```

4. **将性别sex和状态state对应的标号转换为对应文本**

   遍历数据如果按照标号为每一条数据添加`sex_text`和`state_text`属性（避免修改原始数据），然后修改模板中性别和状态列的prop属性为`sex_text`和`state_text`。

   ```diff
         getData (params) {
           students(params).then(res => {
             if (res.data.status === 200) {
               this.tableData = res.data.data;
   +            this.tableData.forEach(item => {
   +              item.sex === 1? item.sex_text = '男': item.sex_text = '女';
   +              item.state === '1'
   +              ? item.state_text = '已入学'
   +              : item.state === '2'
   +              ? item.state_text = '未入学'
   +              : item.state_text = '已休学';
   +            })
             }
           })
         }
   ```

   ```html
   <!-- 修改 -->
   <el-table-column prop="sex_text" label="性别" align="center"> </el-table-column>
   <el-table-column prop="state_text" label="状态" align="center"> </el-table-column>
   ```

### 数据分页（前端方法）

1. **使用Element-UI分页组件，添加到StudentList组件模板中**

   ```diff
   <template>
     <div class="studentList">
       <el-table :data="tableData" border style="width: 100%">...</el-table>
   +    <el-pagination
   +      @size-change="handleSizeChange"
   +      @current-change="handleCurrentChange"
   +      :current-page="currentPage"
   +      :page-sizes="[5, 10, 20, 30, 50]"
   +      :page-size="pageSize"
   +      layout="total, sizes, prev, pager, next, jumper"
   +      :total="total">
   +    </el-pagination>
     </div>
   </template>
   
   <script>
   import { students } from '@/api/api.js' 
   export default {
      data() {
         return {
           tableData: [],
   +        currentPage: 1,  // 当前页数
   +        pageSize: 10,  // 每页显示条数，
   +        total: 0  // 数据总条数
         }
       },
       methods: {
         getData (params) {
           students(params).then(res => {
             if (res.data.status === 200) {
               this.tableData = res.data.data;
   +            this.total = res.data.total;
               this.tableData.forEach(item => {
                 item.sex === 1? item.sex_text = '男': item.sex_text = '女';
                 item.state === '1'
                 ? item.state_text = '已入学'
                 : item.state === '2'
                 ? item.state_text = '未入学'
                 : item.state_text = '已休学';
               })
             }
           })
         },
   +      handleSizeChange(val) {
   +        this.pageSize = val;
   +        this.currentPage = 1;
   +      },
   +      handleCurrentChange(val) {
   +        this.currentPage = val;
   +      }
       },
       created() {
         this.getData();
       }
   }
   </script>
   
   +<style lang="less">
   +.studentList {
   +  .el-pagination {
   +    text-align: left;
   +    margin-top: 20px;
   +  }
   +}
   +</style>
   ```

2. **数据按照分页显示**

   数组`slice`方法两个参数：((当前页数 - 1) * 每页条数，当前页数 * 每页条数)，将data绑定计算属性

   ```vue
   <!-- 修改 -->
   <el-table :data="compData" border style="width: 100%">
       
   <script>
   export default {
       ...,
       computed: {
           compData () {
               return this.tableData.slice((this.currentPage - 1) * this.pageSize, this.currentPage * this.pageSize);
           }
       }
   }
   </script>
   ```

### 表格删除、查询、重置操作

1. **删除操作**

   - 删除按钮绑定点击事件，传入当前行的数据

     ```html
     <template slot-scope="scope">
         <div>
             <el-button type="danger" size="mini" icon="el-icon-delete" @click="del(scope.row)"></el-button>
         </div>
     </template>
     ```

   - 封装删除操作api

     ```js
     export function studentDel(id) {
       return request({
         method: 'delete',
         url: `/students/${id}`
       })
     }
     ```

   - methods选项中定义点击删除事件

     ```js
     del(row) {
         studentDel(row.id).then(res => {
             if (res.data.status === 200) {
                 this.$message({message: '删除数据成功', type: 'success'});
                 this.getData();
             }
         });
     }
     ```

2. **查询和重置操作**

   - 使用Element-UI表单组件

     ```html
     <el-form :inline="true" :model="formInline" class="demo-form-inline" size="small">
         <el-form-item label="姓名">
             <el-input v-model="formInline.name" placeholder="请输入姓名查询"></el-input>
         </el-form-item>
         <el-form-item>
             <el-button type="primary" @click="find">查询</el-button>
         </el-form-item>
         <el-form-item>
             <el-button type="primary" @click="reset">重置</el-button>
         </el-form-item>
     </el-form>
     ```

   - 查询find和重置reset方法

     ```vue
     <script>
     export default {
         data () {
             return {
                 ...,
                 formInline: {
                 	name: ''
             	}
             }
         },
         methods: {
             find() {
                 this.getData(this.formInline);
             },
             reset() {
                 this.formInline = {};
                 this.getData();
             }
         }
     }
     </script>
     ```

## 信息列表InfoList组件

1. **InfoList组件基础布局**

   ```vue
   <template>
     <div class="infoList">
       <!-- 新增按钮 -->
       <el-form :inline="true" class="demo-form-inline" size="small">
         <el-form-item>
           <el-button type="primary" @click="addStudent">新增</el-button>
         </el-form-item>
       </el-form>
   
       <!-- 表格 -->
       <el-table :data="tableData" border style="width: 100%">
         <el-table-column prop="name" label="姓名" align="center">
         </el-table-column>
         <el-table-column prop="age" label="年龄" align="center">
         </el-table-column>
         <el-table-column prop="sex" label="性别" align="center">
         </el-table-column>
         <el-table-column prop="father" label="父亲姓名" align="center">
         </el-table-column>
         <el-table-column prop="mother" label="母亲姓名" align="center">
         </el-table-column>
         <el-table-column prop="time" label="入校时间" align="center">
         </el-table-column>
         <el-table-column prop="address" label="家庭住址" align="center">
         </el-table-column>
         <el-table-column prop="phone" label="联系方式" align="center">
         </el-table-column>
   
         <el-table-column label="操作" align="center">
           <template slot-scope="scope">
             <div>
               <!-- 修改 -->
               <el-button type="danger" size="mini" icon="el-icon-edit" @click="edit(scope.row)"></el-button>
               <!-- 删除 -->
               <el-button type="danger" size="mini" icon="el-icon-delete" @click="del(scope.row)"></el-button>
             </div>
           </template>
         </el-table-column>
       </el-table>
   
       <!-- 新增学生信息弹窗 -->
       <el-dialog width="500px" :title="state? '添加学生信息': '修改学生信息'" :visible.sync="dialogFormVisible">
         <el-form :model="form" :rules="rules" ref="form">
           <el-form-item label="姓名" :label-width="formLabelWidth" prop="name">
             <el-input v-model="form.name" autocomplete="off"></el-input>
           </el-form-item>
           <el-form-item label="性别" :label-width="formLabelWidth" prop="sex">
             <el-radio v-model="form.sex" label="1">男</el-radio>
             <el-radio v-model="form.sex" label="2">女</el-radio>
           </el-form-item>
           <el-form-item label="年龄" :label-width="formLabelWidth" prop="age">
             <el-input v-model="form.age" autocomplete="off"></el-input>
           </el-form-item>
           <el-form-item label="父亲姓名" :label-width="formLabelWidth" prop="father">
             <el-input v-model="form.father" autocomplete="off"></el-input>
           </el-form-item>
           <el-form-item label="母亲姓名" :label-width="formLabelWidth" prop="mother">
             <el-input v-model="form.mother" autocomplete="off"></el-input>
           </el-form-item>
           <el-form-item label="入校时间" :label-width="formLabelWidth" prop="time">
             <el-date-picker v-model="form.time" format="yyyy 年 MM 月 dd 日" value-format="yyyy-MM-dd" type="date" placeholder="选择日期">
       </el-date-picker>
           </el-form-item>
           <el-form-item label="家庭地址" :label-width="formLabelWidth" prop="address">
             <el-input v-model="form.address" autocomplete="off"></el-input>
           </el-form-item>
           <el-form-item label="联系方式" :label-width="formLabelWidth" prop="phone">
             <el-input v-model="form.phone" autocomplete="off"></el-input>
           </el-form-item>
         </el-form>
         <div slot="footer" class="dialog-footer">
           <el-button @click="closeInfo('form')">取 消</el-button>
           <el-button type="primary" @click="sure('form')"
             >确 定</el-button
           >
         </div>
       </el-dialog>
     </div>
   </template>
   
   <script>
   export default {
       name: 'infoList',
       data () {
           return {
               tableData: [],  // 表格数据
               dialogFormVisible: false,  // 控制弹窗的显示和隐藏
               state: true,  // 动态展示添加/修改学生信息的标题
               form: {  // 表单数据
                   name: '',
                   sex: '1',
                   age: '',
                   father: '',
                   mother: '',
                   address: '',
                   time: '',
                   phone: ''
               },
               rules: {  // 校验规则
                   name: [{ required: true, message: '请输入姓名'}],
                   sex: [{ required: true}],
                   age: [{ required: true, message: '请输入年龄'}],
                   address: [{ required: true, message: '请输入家庭地址'}],
                   time: [{ required: true, message: '请输入入学时间'}],
                   phone: [{ required: true, message: '请输入联系方式'}]
               },
               formLabelWidth: '80px',  // 表单标签宽度
           }
       }
   }
   </script>
   
   <style lang="scss">
   .infoList {
     .demo-form-inline,
     .el-form-item {
       text-align: left;
     }
   }
   </style>
   ```

2. **实现组件中的各种方法**

   - 新增按钮点击事件：跳出弹窗，并将表单展示数据还原为初始状态

     ```vue
     <script>
     export default {
         methods: {
             addStudent() {
                 this.state = true;
                 this.dialogFormVisible = true;
                 this.form = {  // 表单数据
                     id: 0
                     name: '',
                     sex: '1',
                     age: '',
                     father: '',
                     mother: '',
                     address: '',
                     time: '',
                     phone: ''
                 };
             }
         }
     }
     </script>
     ```

   - 获取数据，渲染表格

     ```js
     // @/api/api.js
     
     export function getInfo() {
         return request({
             method: 'get',
             url: '/info'
         })
     }
     ```

     ```vue
     <script>
     import { getInfo } from '@/api/api.js'
     export default {
         methods: {
             getData() {
                 getInfo().then(res => {
                     if (res.data.status === 200) {
                         this.tableData = res.data.data;
                         this.total = res.data.total;
                     }
                 })
             }
         },
         created() {
             this.getData();
         }
     }
     </script>
     ```

   - 表格中每一条数据的修改和删除按钮的点击事件

     ```js
     // @/api/api.js
     // 删除列表数据的接口
     export function infoDel (id) {
         return request({
             method: 'delete',
             url: `/info/${id}`
         })
     }
     ```

     ```vue
     <script>
     export default {
         methods: {
             edit(row) {
                 this.form = {...row};
                 this.state = false;
                 this.dialogFormVisible = true;
             },
             
             del(row) {
                 this.$alert('你确定要删除吗？', '提示', {
                     confirmButtonText: '确定',
                     callback: () => {
                         infoDel(row.id).then(res => {
                             if (res.data.status === 200) {
                                 this.getData();
                                 this.$message({ message: res.data.message, type: 'success' });
                             }
                         });
                     }
                 });
             }
         }
     }
     </script>
     ```

   - 弹窗表单提交事件

     ```js
     // @/api/api.js
     import qs from 'qs'
     
     export function info(type, data) {
         data = qs.stringify(data);
         let obj = { method: type, url: '/info', data };
         return request(obj);
     }
     ```

     ```vue
     <script>
     import { info } from '@/api/api.js'
     export default {
         methods: {
             sure(form) {
                 this.$refs[form].validate(valid => {
                     if (valid) {
                         if (this.state) {  // 新增操作
                             this.form.id = this.total;
                             info('post', this.form).then(res => {
                                 if(res.data.status === 200) {
                                     this.getData();
                                     this.dialogFormVisible = false;
                                     this.$message({ type: 'success', message: res.data.message });
                                 }
                             });
                         } else {  // 修改操作
                             info('put', this.form).then(res => {
                                 if(res.data.status === 200) {
                                     this.getData();
                                     this.dialogFormVisible = false;
                                     this.$message({ type: 'success', message: res.data.message });
                                 }
                             });
                         }
                     }
                 });
             }
         }
     }
     </script>
     ```

   - 关闭弹出表单事件，重置表单校验

     ```vue
     <script>
     export default {
         methods: {
             closeInfo(form) {
               this.$refs[form].resetFields();
               this.dialogFormVisible = false;
             }
         }
     }
     </script>
     ```

## 信息管理InfoLists组件

在信息列表基础上对新增、修改、删除方法进行封装

```js
// 获取表格数据
export function getData(root, url, params) {
  root.request.get(url, { params: params || {} })
    .then(res => {
      if (res.data.status === 200) {
        root.tableData = res.data.data;
        root.total = res.data.total;
      }
    })
    .catch(err => { throw err });
}

// 新增修改方法封装
import qs from 'qs'
export function changeInfo(root, method, url, form, callback) {
  let data = qs.stringify(data);
  root.request[method](url, data).then(res => {
    if (res.data.status === 200) {
      callback(root, url);
      root.dialogFormVisible = false;
      root.$message({ type: 'success', message: res.data.message });
    }
  }).catch(error => { throw error });
}

// 删除方法封装
export function delData(root, url, id, callFun) {
  root.$alert('你确定要删除吗？', '提示', {
    confirmButtonText: '确定',
    callback: () => {
      root.request.delete(`${url}/${id}`).then(res => {
        if (res.data.status === 200) {
          callFun(root, url);
          root.$message({message: res.data.message, type: 'success'})
        }
      }).catch(error => {throw error})
    }
  })
}
```

```vue
<script>
export default {
    methods: {
        del(row) {
            delData(this, '/info', row.id, getData);
        },
        
        sure(form) {
            this.$refs[form].validate(valid => {
                if (valid) {
                    if(this.state) {  // 新增操作
                        this.form.id = this.total;
                        changeInfo(this, 'post', '/info', this.form, getData);
                    } else {  // 修改操作
                        changeInfo(this, 'put', '/info', this.form, getData);
                    }
                }
            })
        },        
    },
    created() {
        getData(this, '/info');
    }
}
</script>
```

## 作业列表WorkList组件

1. **封装获取表格数据的方法**

   ```js
   // @/utils/table.js
   
   export function getTableData(root, url, params, arr) {
     root.request.get(url, { params: params || {} })
       .then(res => {
         if (res.data.status === 200) {
           root.tableData = res.data.data;
           root.total = res.data.total;
           // arr传入需要修改的字段名称
           // 两层遍历修改数据
           root.tableData.map(item => {
             arr.map(aItem => {
               item[aItem] ? item[aItem + '_text'] = '是' : item[aItem + '_text'] = '否';
             });
           });
           root.loading = false;  // 加载完成取消加载动画
         }
       })
       .catch(err => { throw err });
   }
   ```

2. **后端分页**

   请求地址拼接当前页面和每页显示数据条数，后端接口根据这两个参数返回参数。

   修改`page`和`size`参数值的时候需要重新调用`getTableData`函数

   ```js
   getTableData(this, '/works', {page: this.page, size: val}, ['completed']);
   ```

3. **WorkList组件实现**

   ```vue
   <template>
     <div class="workList">
       <!-- 表格 -->
       <el-table :data="tableData" v-loading="loading" border style="width: 100%">
         <el-table-column prop="id" label="用户ID" align="center">
         </el-table-column>
         <el-table-column prop="userId" label="所属班级" align="center">
         </el-table-column>
         <el-table-column prop="title" label="作业名称" align="center">
         </el-table-column>
         <el-table-column prop="completed_text" label="完成情况" align="center">
         </el-table-column>
       </el-table>
       <!-- 分页 -->
       <el-pagination
         @size-change="handleSizeChange"
         @current-change="handleCurrentChange"
         :current-page="currentPage"
         :page-sizes="[5, 10, 20, 30, 50]"
         :page-size="pageSize"
         layout="total, sizes, prev, pager, next, jumper"
         :total="total"
       >
       </el-pagination>
     </div>
   </template>
   
   <script>
   import { getTableData } from '@/utils/table.js'
   export default {
     data() {
       return {
         tableData: [],  // 表格数据
         total: 0,  // 数据总条数
         page: 1,  // 当前所在页
         size: 10,  // 每页展示条数
         loading: true  // 是否显示加载动画
       }
     },
     created() {
       getTableData(this, '/works', {page: this.page, size: this.size}, ['completed']);
     },
     methods: {
       // 分页相关方法
       handleSizeChange(val) {
         this.size = val;
         this.page = 1;
         getTableData(this, '/works', {page: this.page, size: val}, ['completed']);
       },
   
       handleCurrentChange(val) {
         this.currentPage = val;
         getTableData(this, '/works', {page: val, size: this.size}, ['completed']);
       },
     }
   }
   </script>
   
   <style lang="less">
   .workList {
     .el-pagination {
       text-align: left;
       margin-top: 20px;
     }
   }
   </style>
   ```

## 作业管理WorkMent组件

在作业列表WorkList组件的基础上，将分页组件及其功能封装为一个组件。

```vue
// Pageing.vue
<template>
  <div>
    <el-pagination
      @size-change="handleSizeChange"
      @current-change="handleCurrentChange"
      :current-page="page"
      :page-sizes="[5, 10, 20, 50, 100]"
      :page-size="sise"
      layout="total, sizes, prev, pager, next, jumper"
      :total="total"
      :url="url"
    >
    </el-pagination>
  </div>
</template>
<script>
import { getTableData } from '@/utils/table'
export default {
  props: {
    total: Number,
    url: String,
  },
  data() {
    return {
      page: 1, // 当前页数
      size: 10, // 每页显示条数
    }
  },
  created() {
    getTableData(this.$parent, '/works', { page: this.page, size: this.size }, [
      'completed',
    ])
  },
  methods: {
    handleSizeChange(val) {
      this.size = val
      this.page = 1
      getTableData(this.$parent, '/works', { page: this.page, size: val }, [
        'completed',
      ])
    },
    handleCurrentChange(val) {
      this.page = val
      getTableData(this.$parent, '/works', { page: val, size: this.size }, [
        'completed',
      ])
    },
  },
}
</script>

```

```vue
// WorkMent.vue
<template>
  <div class="workMent">
    <!-- 表格 -->
    <el-table :data="tableData" v-loading="loading" border style="width: 100%">
      <el-table-column prop="id" label="用户ID" align="center">
      </el-table-column>
      <el-table-column prop="userId" label="所属班级" align="center">
      </el-table-column>
      <el-table-column prop="title" label="作业名称" align="center">
      </el-table-column>
      <el-table-column prop="completed_text" label="完成情况" align="center">
      </el-table-column>
    </el-table>
    <!-- 分页 -->
    <Pageing :total="total" :url="url"/>
  </div>
</template>

<script>
import Pageing from '../common/Pageing.vue'
export default {
  name: 'WorkMent',
  components: { Pageing },
  data() {
    return {
      tableData: [],  // 表格数据
      total: 0,  // 数据总条数
      loading: true, // 是否显示加载动画,
      url: '/works'  // 传入到分页组件的url地址
    }
  }
}
</script>

<style lang="less">
.workMent {
  .el-pagination {
    text-align: left;
    margin-top: 20px;
  }
}
</style>
```

# 数据分析

## 数据概览DataView组件

1. **安装echarts模块，并全局挂载**

   `npm i echarts@4`

   ```js
   // main.js
   import echarts from 'echarts'
   Vue.prototype.$echarts = echarts
   ```

2. **搭建数据概览组件基础布局**

   ```vue
   <template>
     <div class="data-view">
       <!-- 柱状图 -->
       <el-card>
         <div id="main1"></div>
       </el-card>
       <!-- 折线图 -->
       <el-card>
         <div id="main2"></div>
       </el-card>
     </div>
   </template>
   
   <script>
   export default {
     name: 'DataView',
   }
   </script>
   
   <style lang="less">
   .data-view {
     width: 100%;
     display: flex;
     justify-content: space-between;
     .el-card {
       width: 50%;
       #main1, #main2 {
         height: 500px;
       }
     }
   }
   </style>
   ```

3. **绘制柱状图**

   使用本地数据绘制。

   ```vue
   <script>
   export default {
     mounted() {
       // 初始化图表容器
       let myChart = this.$echarts.init(document.getElementById('main1'));
       // 
       myChart.setOption({
         title: {
           text: '大佬进阶班',
         },
         tooltip: {},
         xAxis: {
           data: ['一班', '二班', '三班', '四班', '五班', '六班']
         },
         yAxis: {},
         series: [{
           name: '人数',
           type: 'bar',
           data: [45, 42, 46, 48, 52, 47]
         }]
       })
     },
   }
   </script>
   ```

4. **绘制折线图**

   从后端获取数据来绘制折线图。

   先封装获取数据的接口。

   ```js
   // @/api/api.js
   export function dataview() {
       return request({
           method: 'get',
           url: '/dataview'
       })
   }
   ```

   将绘制折线图的操作封装为方法。

   ```vue
   <script>
   import { dataview } from '@/api/api.js'
   export default {
       methods: {
           draw(legend, xAxis, series) {
               let myChart1 = this.$echarts.init(document.getElementById('main2'));
               let option = {
                   title: { text: '会话量'},
                   tooltip: {
                       trigger: 'axis'
                   },
                   legend: {
                       data: legend
                   },
                   xAxis: {
                       type: 'category',
                       data: xAxis
                   },
                   yAxis: {
                       type: 'value'
                   },
                   series: series
               };
               myChart1.setOption(option);
           }
       },
       created() {
           dataview().then(res => {
               if (res.data.status === 200) {
                   let { legend, xAxis, series } = res.data.data;
                   this.draw(legend, xAxis, series);
               }
           }).catch(err => { throw err });
       }
   }
   </script>
   ```

## 地图概览MapView组件

```vue
<template>
  <div class="map-view">
    <div id="main"></div>
  </div>
</template>

<script>
import geoJson from '@/assets/data.json'
export default {
  name: 'MapView',
  mounted() {
    let myChart = this.$echarts.init(document.getElementById('main'));
    this.$echarts.registerMap('china', geoJson);
    let option = {
      backgroundColor: 'rgb(121, 145, 209)',
      geo: {
        map: 'china',
        aspectScale: 0.75,  // scale地图长宽比
        zoom: 1.1,  // 缩放比
        itemStyle: {
          normal: {
            areaColor: {  // 设置每一块区域的颜色
              type: 'radial',  // 径向渐变
              x: 0.5,
              y: 0.5,
              r: 0.8,
              colorStops: [{
                offset: 0,
                color: '#09132c',  // 0%处的颜色
              }, {
                offset: 1,
                color: '#274d68',  // 100%处的颜色
              }],
              globalCoord: true
            },
            shadowColor: 'rgb(58, 115, 192)',
            shadowOffsetX: 10,
            shadowOffsetY: 10,
          }
        },
        regions: [{
          name: '南海诸岛',
          itemStyle: {
            opacity: 0
          }
        }]
      },
      series: [{  // 配置地图相关参数，绘制地图，这个独享是关于地图图表的相关设置
        type: 'map',
        label: {
          normal: {
            show: true,  // 普通状态下展示标签
            textStyle: {
              color: '#1de9b6'
            }
          },
          emphasis: {
            textStyle: {
              color: 'rgb(183, 185, 14)'
            }
          }
        },
        zoom: 1.1,
        map: 'china',
        itemStyle: {
          normal: {
            backgroundColor: 'rgb(147, 235, 248)',
            borderWidth: 1,
            areaColor: {
              type: 'radial',
              x: 0.5,
              y: 0.5,
              r: 0.8,
              colorStops: [{
                offset: 0,
                color: 'rgb(31, 54, 150)',  // 0%处的颜色
              }, {
                offset: 1,
                color: 'rgb(89, 128, 142)',  // 100%处的颜色
              }],
              globalCoord: true
            }
          },
          emphasis: {  // 高亮
            areaColor: 'rgb(46, 229, 206)',
            borderWidth: 0.1,
          }
        },
      }]
    };
    myChart.setOption(option);
  }
}
</script>

<style lang="less">
  .map-view {
    width: 100%;
    #main {
      width: 100%;
      height: 600px;
    }
  }
</style>
```

## 旅游地图TravelMap组件

在地图概览组件基础上添加散点图和线路图，封装方法。

1. **封装获取旅游地图数据的接口**

   ```js
   // @/api/api.js
   export function travel() {
     return request({
       method: 'get',
       url: '/travel'
     })
   }
   ```

2. **TravelMap组件中绘制散点图、线路图**

   ```diff
   <template>
     <div class="travel-map">
       <div id="main"></div>
     </div>
   </template>
   
   <script>
   import geoJson from '@/assets/data.json'
   import { travel } from '@/api/api.js'
   export default {
     name: 'MapView',
     methods: {
       draw(points, linesData) {
         let myChart = this.$echarts.init(document.getElementById('main'))
         this.$echarts.registerMap('china', geoJson)
         let option = {
           backgroundColor: 'rgb(121, 145, 209)',
           geo: {
             map: 'china',
             aspectScale: 0.75, // scale地图长宽比
             zoom: 1.1, // 缩放比
             itemStyle: {
               normal: {
                 areaColor: {
                   // 设置每一块区域的颜色
                   type: 'radial', // 径向渐变
                   x: 0.5,
                   y: 0.5,
                   r: 0.8,
                   colorStops: [
                     {
                       offset: 0,
                       color: '#09132c', // 0%处的颜色
                     },
                     {
                       offset: 1,
                       color: '#274d68', // 100%处的颜色
                     },
                   ],
                   globalCoord: true,
                 },
                 shadowColor: 'rgb(58, 115, 192)',
                 shadowOffsetX: 10,
                 shadowOffsetY: 10,
               },
             },
             regions: [
               {
                 name: '南海诸岛',
                 itemStyle: {
                   opacity: 0,
                 },
               },
             ],
           },
           series: [
             {
               // 配置地图相关参数，绘制地图，这个独享是关于地图图表的相关设置
               type: 'map',
               label: {
                 normal: {
                   show: true, // 普通状态下展示标签
                   textStyle: {
                     color: '#1de9b6',
                   },
                 },
                 emphasis: {
                   textStyle: {
                     color: 'rgb(183, 185, 14)',
                   },
                 },
               },
               zoom: 1.1,
               map: 'china',
               itemStyle: {
                 normal: {
                   backgroundColor: 'rgb(147, 235, 248)',
                   borderWidth: 1,
                   areaColor: {
                     type: 'radial',
                     x: 0.5,
                     y: 0.5,
                     r: 0.8,
                     colorStops: [
                       {
                         offset: 0,
                         color: 'rgb(31, 54, 150)', // 0%处的颜色
                       },
                       {
                         offset: 1,
                         color: 'rgb(89, 128, 142)', // 100%处的颜色
                       },
                     ],
                     globalCoord: true,
                   },
                 },
                 emphasis: {
                   // 高亮
                   areaColor: 'rgb(46, 229, 206)',
                   borderWidth: 0.1,
                 },
               },
             },
   +          // 关于地图中散点图的配置
   +          {
   +            type: 'effectScatter',
   +            coordinateSystem: 'geo',
   +            showEffectOn: 'render', // 何时显示特效
   +            symbolSize: 10, // 散点大小
   +            zlevel: 1,
   +            data: points,
   +            rippleEffect: {
   +              // 涟漪特效配置
   +              period: 15, // 动画时间
   +              scale: 4, // 缩放比
   +              brushType: 'fill', // 波纹绘制方式
   +            },
   +          },
   +          // 关于地图中线路动画效果设置
   +          {
   +            type: 'lines',
   +            zlevel: 2,
   +            effect: {
   +                show: true,
   +                period: 4,
   +                symbol: 'arrow',
   +                symbolSize: 7,
   +                trailLength: 0.4  // 箭头拖尾效果
   +            },
   +            lineStyle: {
   +                normal: {
   +                    color: '#1DE9B6',
   +                    width: 1,
   +                    opacity: 0.1,
   +                    curveness: 0.3  // 弯曲程度
   +                }
   +            },
   +            data: linesData
   +          },
   +        ],
   +      }
         myChart.setOption(option)
       },
     },
   +  created() {
   +    travel().then((res) => {
   +      if (res.data.status === 200) {
   +        let { points, linesData } = res.data.data;
   +        this.draw(points, linesData);
   +      }
   +    })
   +  },
   }
   </script>
   
   <style lang="less">
   .travel-map {
     width: 100%;
     #main {
       width: 100%;
       height: 600px;
     }
   }
   </style>
   ```

## 分数地图ScoreMap组件

复制资源来源：http://192.144.199.210:8080/editor/index.html?chart_id=7Ph0yZtNoJ1JhGDl

```vue
<template>
  <div class="score-map">
    <div id="main"></div>
  </div>
</template>

<script>
import chinaJson from 'echarts/map/json/china'
export default {
  data() {
    return {}
  },
  mounted() {
    let myChart = this.$echarts.init(document.getElementById('main'))
    this.$echarts.registerMap('china', chinaJson)
    // 复制示例代码
    var name_title = '中国人民大学2017年各省市计划录取人数'
    var subname = '数据爬取自千栀网\n，\n上海、浙江无文理科录取人数'
    var nameColor = ' rgb(55, 75, 113)'
    var name_fontFamily = '等线'
    var subname_fontSize = 15
    var name_fontSize = 18
    var mapName = 'china'
    var data = [
      { name: '北京', value: 177 },
      { name: '天津', value: 42 },
      { name: '河北', value: 102 },
      { name: '山西', value: 81 },
      { name: '内蒙古', value: 47 },
      { name: '辽宁', value: 67 },
      { name: '吉林', value: 82 },
      { name: '黑龙江', value: 66 },
      { name: '上海', value: 24 },
      { name: '江苏', value: 92 },
      { name: '浙江', value: 114 },
      { name: '安徽', value: 109 },
      { name: '福建', value: 116 },
      { name: '江西', value: 91 },
      { name: '山东', value: 119 },
      { name: '河南', value: 137 },
      { name: '湖北', value: 116 },
      { name: '湖南', value: 114 },
      { name: '重庆', value: 91 },
      { name: '四川', value: 125 },
      { name: '贵州', value: 62 },
      { name: '云南', value: 83 },
      { name: '西藏', value: 9 },
      { name: '陕西', value: 80 },
      { name: '甘肃', value: 56 },
      { name: '青海', value: 10 },
      { name: '宁夏', value: 18 },
      { name: '新疆', value: 67 },
      { name: '广东', value: 123 },
      { name: '广西', value: 59 },
      { name: '海南', value: 14 },
    ]

    var geoCoordMap = {}
    var toolTipData = [
      {
        name: '北京',
        value: [
          { name: '文科', value: 95 },
          { name: '理科', value: 82 },
        ],
      },
      {
        name: '天津',
        value: [
          { name: '文科', value: 22 },
          { name: '理科', value: 20 },
        ],
      },
      {
        name: '河北',
        value: [
          { name: '文科', value: 60 },
          { name: '理科', value: 42 },
        ],
      },
      {
        name: '山西',
        value: [
          { name: '文科', value: 40 },
          { name: '理科', value: 41 },
        ],
      },
      {
        name: '内蒙古',
        value: [
          { name: '文科', value: 23 },
          { name: '理科', value: 24 },
        ],
      },
      {
        name: '辽宁',
        value: [
          { name: '文科', value: 39 },
          { name: '理科', value: 28 },
        ],
      },
      {
        name: '吉林',
        value: [
          { name: '文科', value: 41 },
          { name: '理科', value: 41 },
        ],
      },
      {
        name: '黑龙江',
        value: [
          { name: '文科', value: 35 },
          { name: '理科', value: 31 },
        ],
      },
      {
        name: '上海',
        value: [
          { name: '文科', value: 12 },
          { name: '理科', value: 12 },
        ],
      },
      {
        name: '江苏',
        value: [
          { name: '文科', value: 47 },
          { name: '理科', value: 45 },
        ],
      },
      {
        name: '浙江',
        value: [
          { name: '文科', value: 57 },
          { name: '理科', value: 57 },
        ],
      },
      {
        name: '安徽',
        value: [
          { name: '文科', value: 57 },
          { name: '理科', value: 52 },
        ],
      },
      {
        name: '福建',
        value: [
          { name: '文科', value: 59 },
          { name: '理科', value: 57 },
        ],
      },
      {
        name: '江西',
        value: [
          { name: '文科', value: 49 },
          { name: '理科', value: 42 },
        ],
      },
      {
        name: '山东',
        value: [
          { name: '文科', value: 67 },
          { name: '理科', value: 52 },
        ],
      },
      {
        name: '河南',
        value: [
          { name: '文科', value: 69 },
          { name: '理科', value: 68 },
        ],
      },
      {
        name: '湖北',
        value: [
          { name: '文科', value: 60 },
          { name: '理科', value: 56 },
        ],
      },
      {
        name: '湖南',
        value: [
          { name: '文科', value: 62 },
          { name: '理科', value: 52 },
        ],
      },
      {
        name: '重庆',
        value: [
          { name: '文科', value: 47 },
          { name: '理科', value: 44 },
        ],
      },
      {
        name: '四川',
        value: [
          { name: '文科', value: 65 },
          { name: '理科', value: 60 },
        ],
      },
      {
        name: '贵州',
        value: [
          { name: '文科', value: 32 },
          { name: '理科', value: 30 },
        ],
      },
      {
        name: '云南',
        value: [
          { name: '文科', value: 42 },
          { name: '理科', value: 41 },
        ],
      },
      {
        name: '西藏',
        value: [
          { name: '文科', value: 5 },
          { name: '理科', value: 4 },
        ],
      },
      {
        name: '陕西',
        value: [
          { name: '文科', value: 38 },
          { name: '理科', value: 42 },
        ],
      },
      {
        name: '甘肃',
        value: [
          { name: '文科', value: 28 },
          { name: '理科', value: 28 },
        ],
      },
      {
        name: '青海',
        value: [
          { name: '文科', value: 5 },
          { name: '理科', value: 5 },
        ],
      },
      {
        name: '宁夏',
        value: [
          { name: '文科', value: 10 },
          { name: '理科', value: 8 },
        ],
      },
      {
        name: '新疆',
        value: [
          { name: '文科', value: 36 },
          { name: '理科', value: 31 },
        ],
      },
      {
        name: '广东',
        value: [
          { name: '文科', value: 63 },
          { name: '理科', value: 60 },
        ],
      },
      {
        name: '广西',
        value: [
          { name: '文科', value: 29 },
          { name: '理科', value: 30 },
        ],
      },
      {
        name: '海南',
        value: [
          { name: '文科', value: 8 },
          { name: '理科', value: 6 },
        ],
      },
    ]

    /*获取地图数据*/
    myChart.showLoading()
    var mapFeatures = this.$echarts.getMap(mapName).geoJson.features
    myChart.hideLoading()
    mapFeatures.forEach(function (v) {
      // 地区名称
      var name = v.properties.name
      // 地区经纬度
      geoCoordMap[name] = v.properties.cp
    })

    var max = 480,
      min = 9 // todo
    var maxSize4Pin = 100,
      minSize4Pin = 20

    var convertData = function (data) {
      var res = []
      for (var i = 0; i < data.length; i++) {
        var geoCoord = geoCoordMap[data[i].name]
        if (geoCoord) {
          res.push({
            name: data[i].name,
            value: geoCoord.concat(data[i].value),
          })
        }
      }
      return res
    }
    let option = {
      title: {
        text: name_title,
        subtext: subname,
        x: 'center',
        textStyle: {
          color: nameColor,
          fontFamily: name_fontFamily,
          fontSize: name_fontSize,
        },
        subtextStyle: {
          fontSize: subname_fontSize,
          fontFamily: name_fontFamily,
        },
      },
      tooltip: {
        trigger: 'item',
        formatter: function (params) {
          if (typeof params.value[2] == 'undefined') {
            var toolTiphtml = ''
            for (var i = 0; i < toolTipData.length; i++) {
              if (params.name == toolTipData[i].name) {
                toolTiphtml += toolTipData[i].name + ':<br>'
                for (var j = 0; j < toolTipData[i].value.length; j++) {
                  toolTiphtml +=
                    toolTipData[i].value[j].name +
                    ':' +
                    toolTipData[i].value[j].value +
                    '<br>'
                }
              }
            }
            console.log(toolTiphtml)
            // console.log(convertData(data))
            return toolTiphtml
          } else {
            var toolTiphtml = ''
            for (var i = 0; i < toolTipData.length; i++) {
              if (params.name == toolTipData[i].name) {
                toolTiphtml += toolTipData[i].name + ':<br>'
                for (var j = 0; j < toolTipData[i].value.length; j++) {
                  toolTiphtml +=
                    toolTipData[i].value[j].name +
                    ':' +
                    toolTipData[i].value[j].value +
                    '<br>'
                }
              }
            }
            console.log(toolTiphtml)
            // console.log(convertData(data))
            return toolTiphtml
          }
        },
      },
      // legend: {
      //     orient: 'vertical',
      //     y: 'bottom',
      //     x: 'right',
      //     data: ['credit_pm2.5'],
      //     textStyle: {
      //         color: '#fff'
      //     }
      // },
      visualMap: {
        show: true,
        min: 0,
        max: 200,
        left: 'left',
        top: 'bottom',
        text: ['高', '低'], // 文本，默认为数值文本
        calculable: true,
        seriesIndex: [1],
        inRange: {
          // color: ['#3B5077', '#031525'] // 蓝黑
          // color: ['#ffc0cb', '#800080'] // 红紫
          // color: ['#3C3B3F', '#605C3C'] // 黑绿
          // color: ['#0f0c29', '#302b63', '#24243e'] // 黑紫黑
          // color: ['#23074d', '#cc5333'] // 紫红
          color: ['#00467F', '#A5CC82'], // 蓝绿
          // color: ['#1488CC', '#2B32B2'] // 浅蓝
          // color: ['#00467F', '#A5CC82'] // 蓝绿
          // color: ['#00467F', '#A5CC82'] // 蓝绿
          // color: ['#00467F', '#A5CC82'] // 蓝绿
          // color: ['#00467F', '#A5CC82'] // 蓝绿
        },
      },
      /*工具按钮组*/
      // toolbox: {
      //     show: true,
      //     orient: 'vertical',
      //     left: 'right',
      //     top: 'center',
      //     feature: {
      //         dataView: {
      //             readOnly: false
      //         },
      //         restore: {},
      //         saveAsImage: {}
      //     }
      // },
      geo: {
        show: true,
        map: mapName,
        label: {
          normal: {
            show: false,
          },
          emphasis: {
            show: false,
          },
        },
        roam: true,
        itemStyle: {
          normal: {
            areaColor: '#031525',
            borderColor: '#3B5077',
          },
          emphasis: {
            areaColor: '#2B91B7',
          },
        },
      },
      series: [
        {
          name: '散点',
          type: 'scatter',
          coordinateSystem: 'geo',
          data: convertData(data),
          symbolSize: function (val) {
            return val[2] / 10
          },
          label: {
            normal: {
              formatter: '{b}',
              position: 'right',
              show: true,
            },
            emphasis: {
              show: true,
            },
          },
          itemStyle: {
            normal: {
              color: '#05C3F9',
            },
          },
        },
        {
          type: 'map',
          map: mapName,
          geoIndex: 0,
          aspectScale: 0.75, //长宽比
          showLegendSymbol: false, // 存在legend时显示
          label: {
            normal: {
              show: true,
            },
            emphasis: {
              show: false,
              textStyle: {
                color: '#fff',
              },
            },
          },
          roam: true,
          itemStyle: {
            normal: {
              areaColor: '#031525',
              borderColor: '#3B5077',
            },
            emphasis: {
              areaColor: '#2B91B7',
            },
          },
          animation: false,
          data: data,
        },
        {
          name: '点',
          type: 'scatter',
          coordinateSystem: 'geo',
          symbol: 'pin', //气泡
          symbolSize: function (val) {
            var a = (maxSize4Pin - minSize4Pin) / (max - min)
            var b = minSize4Pin - a * min
            b = maxSize4Pin - a * max
            return a * val[2] + b
          },
          label: {
            normal: {
              show: true,
              textStyle: {
                color: '#fff',
                fontSize: 9,
              },
            },
          },
          itemStyle: {
            normal: {
              color: '#F62157', //标志颜色
            },
          },
          zlevel: 6,
          data: convertData(data),
        },
        {
          name: 'Top 5',
          type: 'effectScatter',
          coordinateSystem: 'geo',
          data: convertData(
            data
              .sort(function (a, b) {
                return b.value - a.value
              })
              .slice(0, 5)
          ),
          symbolSize: function (val) {
            return val[2] / 10
          },
          showEffectOn: 'render',
          rippleEffect: {
            brushType: 'stroke',
          },
          hoverAnimation: true,
          label: {
            normal: {
              formatter: '{b}',
              position: 'right',
              show: true,
            },
          },
          itemStyle: {
            normal: {
              color: 'yellow',
              shadowBlur: 10,
              shadowColor: 'yellow',
            },
          },
          zlevel: 1,
        },
      ],
    }
    myChart.setOption(option)
  },
}
</script>

<style lang="less">
.score-map {
  width: 100%;
  #main {
    width: 100%;
    height: 500px;
  }
}
</style>
```

# 用户中心

## 权限管理User组件

权限管理和动态路由的思路：根据不同的用户登录上来，返回对应的路由权限菜单。

可以通过树形控件达到权限的精准控制，根据不同角色，勾选不同的菜单权限，将菜单数据提交给后端进行保存，后端保存之后，在用户进行登录的时候就会查询该用户所拥有的菜单数据，最终进行动态的渲染。动态添加路由使用`router.addRoutes`方法（vue 3.x版本方法，已废弃），后续使用`router.addRoute`方法进行动态路由添加。

```vue
<template>
  <div>
    <el-tree
      :data="menus"
      show-checkbox
      node-key="name"
      :props="defaultProps"
      ref="tree">
    </el-tree>
    <el-button @click="getCheckedNodes">通过node获取</el-button>
  </div>
</template>

<script>
export default {
  name: 'User',
  data() {
    return {
      menus: [],
      defaultProps: {
        label: 'name',
        children: 'children'
      }
    }
  },
  created() {
    this.menus = [...this.$router.options.routes]
  },
  methods: {
    getCheckedNodes() {
      let arr = this.$refs.tree.getCheckedNodes();
      console.log(arr);  // 选中的路由
    }
  }
}
</script>

<style></style>
```

**路由导航守卫**

在没有登录的情况下，不能直接访问系统。主要跳转到登录页。

```js
// main.js
router.beforeEach((to, from, next) => {
    if (!localStorage.getItem('username')) {
        if (to.path !== '/login') {
            next('/login');
        } else {
            next();
        }
    }
    next();
})
```

# Nginx部署

1. 打包Vue项目

   ```bash
   yarn build
   ```

2. **配置安装路径下的`nginx.conf`文件**

   `C:\Users\yanglu\Downloads\nginx-1.22.1\conf\nginx.conf`

   ```
   server {
           listen       8080;
           server_name  localhost;
           location / {
               root   C:\Users\yanglu\Desktop\project\vue-project\dist;
               index  index.html index.htm;
               try_files $uri $uri/ @router; # 解决页面刷新404问题
           }
           location @router {
               rewrite ^.*$ /index.html last; # Vue项目路由不是真实存在的
           }
   }
   ```

3. **检验配置文件是否配置成功**

   ```bash
   nginx -t -c C:\Users\yanglu\Downloads\nginx-1.22.1\conf\nginx.conf
   ```

4. **启动Nginx**

   ```bash
   start nginx
   ```

   

